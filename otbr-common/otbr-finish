#!/usr/bin/with-contenv bash
#==============================================================================
# OpenThread BorderRouter Daemon finish script (multi-container safe)
# Skips shared iptables/ipset teardown to avoid breaking sibling containers.
#==============================================================================
if test "$1" -eq 256 ; then
  e=$((128 + $2))
else
  e="$1"
fi

if test "$e" -ne 0; then
    echo "WARNING: otbr-agent exited with code $e"
    echo "$e" > /run/s6-linux-init-container-results/exitcode
    /run/s6/basedir/bin/halt
    exit 125
fi
echo "INFO: otbr-agent exited cleanly."
